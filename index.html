<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LPO</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      direction: ltr;
      background: #f9f9f9;
      padding: 0;
      margin: 0;
    }

    .page-container {
      display: flex;
      gap: 20px;
      padding: 20px;
      align-items: flex-start;
    }

    .lpo-container {
      flex: 1;
      min-width: 0;
    }

    .saved-lpos-panel {
      width: 300px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 20px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
    }

    .saved-lpos-panel h3 {
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
      color: #234082;
    }

    button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 12px;
      direction: ltr;
    }

    td textarea {
      font-weight: bold;
      width: 100%;
      min-height: 40px;
      resize: none;
      overflow: hidden;
      word-wrap: break-word;
      white-space: pre-wrap;
      box-sizing: border-box;
      line-height: 1.4;
    }

    .lpo {
      background: url('https://cdn.shopify.com/s/files/1/0636/1035/5827/files/2.png') no-repeat center;
      background-size: contain;
      background-color: #ffffff;
      max-width: 900px;
      margin: auto;
      position: relative;
      padding: 5px 40px 20px 40px;
    }

    .header {
      background: url('https://cdn.shopify.com/s/files/1/0636/1035/5827/files/1.jpg') no-repeat center top;
      background-size: cover;
      height: 150px;
      position: relative;
    }

    .header-info {
      position: absolute;
      width: 50%;
      font-weight: bold;
      top: 90px;
      margin-top: -9px;
      bottom: 10px;
      left: 0px;
      color: #000;
      background-color: #fff;
      font-size: 12px;
    }

    .date-info {
      position: absolute;
      top: 79px;
      bottom: 10px;
      left: 20px;
      color: #fff;
      font-size: 12px;
    }

    .user-info {
      position: absolute;
      top: 10px;
      right: 40px;
      color: #fff;
      font-size: 12px;
      text-align: right;
    }

    .delete-btn {
      background-color: transparent;
      color: red;
      border: none;
      font-size: 12px;
      cursor: pointer;
    }

    .delete-lpo-btn {
      background: none;
      color: #f44336;
      border: none;
      font-size: 12px;
      cursor: pointer;
      padding: 5px;
    }

    .action-buttons {
      margin-top: 15px;
    }

    .lpo-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      margin-right: 10px;
      cursor: pointer;
    }

    .footer {
      background: url('') no-repeat center bottom;
      background-size: contain;
      height: 120px;
      bottom: 0;
      left: 0;
      width: 100%;

    }

    .section {
      margin: 0px 0;
    }
    .trapezoid {
      position: absolute;
      width: 420px;
      height: 60px;
      top: 98px;
      bottom: 10px;
      left: 480px;
      background-color: #fff; /* Main blue */
      clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%); /* Cut left slant */
    }
    .contact-info {
      padding: 3px 0px 0px 100px;
      display: flex;
      align-items: center;
      gap: 30px; /* Space between WhatsApp and Email */
      font-size: 14px;
    }
    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: #1d3e78;
    }
    .contact-item i {
      
      font-size: 22px;
    }
    
    .se {
      position: absolute;
      top: 60px;
      bottom: 10px;
      left: 717px;
      color: #fff;
      font-size: 12px;
    }
 .sec {
      position: absolute;
      top: 0px;
      bottom: 10px;
      left: 30px;
      color: #fff;
    }

    .section h3 {
      margin-top: 0px;
      margin-bottom: 5px;
    }

    td input {
      width: 100%;
      font-size: 15px;
      background: transparent;
      border: none;
      resize: vertical;
      box-sizing: border-box;
      white-space: normal;
      word-wrap: break-word;
      font-weight: bold;
    }

    .tablec {
      padding: 1px;
      text-align: center;
      background-color: #234082;
      color: #fff;
    }

    .tableb {
      padding: 5px 15px;
      text-align: left;
      background-color: #234082;
      color: #fff;
      width: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

     .tabled {
      
      text-align: left;
      color: #234082;
      width: 260px;
    }
.tabledx {
      margin-top: 15px;
      text-align: left;
      color: #fffff;
      width: 260px;
     font-size:24px;
    }
    
 .tablem {
      padding: 1px;
      text-align: center;
      background-color: #234082;
      color: #fff;
    }   
 .tabledin {
      padding: 15px;
      text-align: left;
      color: #fffff;
      width: 260px;
     font-size:14px;
    }

    table {
      table-layout: auto;
      word-wrap: break-word;
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }

    th, td {
      border: 1px solid #000000;
      padding: 1px 8px;
      font-weight: bold;
      text-align: center;
    }
tablen {
      table-layout: auto;
      word-wrap: break-word;
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }

    .b-details {
      padding: 5px;
      flex: 1 1 50%;
    }
    .bank-details {
      margin-top: 15px;
      font-weight: bold;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px;
      flex: 1 1 63%;
    }
    

    .summary {
      font-weight: bold;
      padding: 5px;
      flex: 1 1 50%;
    }

    .totals td {
      font-weight: bold;
      padding: 10px;
      text-align: center;
    }

    .signature {
      font-weight: bold;
      margin-top: 0px;
      text-align: left;
    }

    .details-section {
      margin-top: 25px;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .client-details,
    .project-details {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 5px;
      flex: 1 1 45%;
    }

    #lpoList {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #lpoList li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin: 5px 0;
      background: #f5f5f5;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #lpoList li:hover {
      background: #e0e0e0;
    }

   @media (max-width: 1200px) {
      .page-container {
        flex-direction: column;
      }

      .saved-lpos-panel {
        width: auto;
        position: static;
      }
    }

    @media print {
      .no-export,
      .saved-lpos-panel {
        display: none !important;
      }
    }

    .export-pdf .no-export,
    .export-pdf .saved-lpos-panel {
      display: none !important;
    }
    /* Add these to your existing style section */
@media print {

  td textarea {
    height: auto !important;
    overflow: visible !important;
  }
}



/* Ensure consistent text sizing */
.export-pdf textarea,
.export-pdf input {
  font-size: 14px !important;
  line-height: 1.4 !important;
}
  </style>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="page-container">
  <div class="lpo-container">
    <div class="lpo">
      <div id="lpo">
        <!-- Add this inside the body somewhere -->
<span id="currentUser" style="display:none;">System User</span>
<span id="currentDateTime" style="display:none;">N/A</span>

        <div class="header">
         <div class="trapezoid">
             <div class="contact-info">
  <a href="https://wa.me/97126416009" class="contact-item" target="_blank">
    <i class="fab fa-whatsapp"></i>
    +971 2 641 6009
  </a>

  <a href="mailto:info@kon-uae.com" class="contact-item">
    <i class="fas fa-envelope"></i>
    info@kon-uae.com
  </a>
</div>
            <div class="contact-info">
  <a href="https://maps.google.com/?q=24.440023,54.412598" class="contact-item" target="_blank">
    <i class="fas fa-map-marker-alt"></i>
    6, Al Milaysa St
Hadbat Al Za'faranah, AD
  </a>
</div>
            
          </div>
         <div class="sec">
            <h3 class="tabledx">LPO</h3>
        </div>
          
         
          <div class="header-info">
            <table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" align="left" width="750" style="width:562.75pt;border-collapse:collapse;mso-yfti-tbllook:
 1184;mso-table-lspace:9.0pt;margin-left:6.75pt;mso-table-rspace:9.0pt;
 margin-right:6.75pt;mso-table-anchor-vertical:page;mso-table-anchor-horizontal:
 margin;mso-table-left:-22.55pt;mso-table-top:105.8pt;mso-padding-alt:0cm 5.4pt 0cm 5.4pt">
 <tbody><tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes;height:14.4pt;mso-row-margin-right:
  295.8pt">
  <td width="61" nowrap="" style="width:45.5pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:14.4pt">
  <p class="MsoNormal" align="right" style="margin-bottom:0cm;text-align:right;
  line-height:normal;mso-element:frame;mso-element-frame-hspace:9.0pt;
  mso-element-wrap:around;mso-element-anchor-vertical:page;mso-element-anchor-horizontal:
  margin;mso-element-left:-22.5pt;mso-element-top:105.8pt;mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><a name="_Hlk108869564"><span lang="EN-GB" style="font-family:&quot;Times New Roman&quot;,serif;mso-ascii-theme-font:major-bidi;
  mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:major-bidi;
  mso-bidi-theme-font:major-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"><input style="padding: 5px 0px 5px 25px; width:90px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="DATE"><span style="mso-spacerun:yes">&nbsp; </span><o:p></o:p></span></a></span></p>
  </td>
  
  <td width="295" nowrap="" colspan="2" style="width:221.45pt;border-top:solid windowtext 1.0pt;
  border-left:none;border-bottom:none;border-right:solid windowtext 1.0pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:14.4pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal;mso-element:frame;mso-element-frame-hspace:9.0pt;
  mso-element-wrap:around;mso-element-anchor-vertical:page;mso-element-anchor-horizontal:
  margin;mso-element-left:-22.5pt;mso-element-top:105.8pt;mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><span style="mso-bookmark:_Hlk108869564"><span lang="EN-GB" style="font-family:&quot;Times New Roman&quot;,serif;mso-ascii-theme-font:
  major-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  major-bidi;mso-bidi-theme-font:major-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"><input style="padding: 5px 0px 5px 55px; color:000; width:200px; font-size:14px;font-weight: bold; background:transparent; border-color:transparent;" type="txt" id="lpoDate"><o:p></o:p></span></span></span></p>
  </td>
  <td style="mso-cell-special:placeholder;border:none;padding:0cm 0cm 0cm 0cm" width="394" colspan="3"><p class="MsoNormal">&nbsp;</p></td>
  
 </tr>
 <tr style="mso-yfti-irow:1;height:15.9pt;mso-row-margin-right:295.8pt">
  <td width="61" nowrap="" style="width:45.5pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt:
  solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding:
  0cm 5.4pt 0cm 5.4pt;height:15.9pt">
  <p class="MsoNormal" align="right" style="margin-bottom:0cm;text-align:right;
  line-height:normal;mso-element:frame;mso-element-frame-hspace:9.0pt;
  mso-element-wrap:around;mso-element-anchor-vertical:page;mso-element-anchor-horizontal:
  margin;mso-element-left:-22.5pt;mso-element-top:105.8pt;mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><span style="mso-bookmark:_Hlk108869564"><span lang="EN-GB" style="font-family:&quot;Times New Roman&quot;,serif;mso-ascii-theme-font:
  major-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  major-bidi;mso-bidi-theme-font:major-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"> <input style="padding: 5px 0px 5px 25px; width:90px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="REF #"><o:p></o:p></span></span></span></p>
  </td>
  
  <td width="295" nowrap="" colspan="2" style="width:221.45pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt;height:15.9pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal;mso-element:frame;mso-element-frame-hspace:9.0pt;
  mso-element-wrap:around;mso-element-anchor-vertical:page;mso-element-anchor-horizontal:
  margin;mso-element-left:-22.5pt;mso-element-top:105.8pt;mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><span style="mso-bookmark:_Hlk108869564"><span lang="EN-GB" style="font-family:&quot;Times New Roman&quot;,serif;mso-ascii-theme-font:
  major-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  major-bidi;mso-bidi-theme-font:major-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"><input style="padding: 5px 0px 5px 55px; color:000; width:200px; font-size:14px;font-weight: bold; background:transparent; border-color:transparent;" type="txt" id="reference"><o:p></o:p></span></span></span></p>
  </td>
  <td style="mso-cell-special:placeholder;border:none;padding:0cm 0cm 0cm 0cm" width="394" colspan="3"><p class="MsoNormal">&nbsp;</p></td>
  
 </tr>
 
 
 
 
 
 
 
 
 
 
</tbody></table>
          </div>
        </div>

     
 

       <div class="section details-section">
          <div class="client-details">
            <h3 class="tableb">VENDOR</h3>
            <p style="margin-bottom: 0px;">
             <input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="Company Name:" id="clientName">
               <input style="width:400px; margin-left: 5px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" id="clientName1">
            </p>
            <p style="margin-top: 0px; margin-bottom: 0px;">
               <input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="Attention:" id="attEmail">
<input style="width:430px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="E-Mail:" id="attEmail1">
<input style="width:430px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="Phone:" id="attEmail2">
<input style="width:430px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="TRN:" id="attEmail3">
            </p>
            <p style="margin-top: 15px;">
              <input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="Quot. REF:" id="lpoNumber">
              
              
            </p>
          </div>

          <div class="project-details">
            <h3 class="tableb">SHIP TO</h3>
            <p style="margin-bottom: 0px;">
            
<input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="Authorized person:" id="projectName">
<input style="width:420px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="Phone:" id="projectName1">
<input style="width:420px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="E-Mail:"  id="projectName2">
              <input style="width:420px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" value="project:"  id="projectName3">
            </p>
            <p style="margin-top: 25px;">
              
              <input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" value="Address:" type="text" id="location">
<input style="width:400px; font-size:14px; font-weight: bold; background:transparent; border-color:transparent;" type="text" id="location1">
            </p>
          </div>
        </div>

        <div style="overflow-x: auto;">
          <div class="section" id="lpoBox">
            <h3 style="font-size:14px; margin-top: 15px;">Item Details</h3>
            <table id="itemsTable">
              <thead class="tablec">
                <tr>
                  <th>Description</th>
                  <th>Unit</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Total</th>
                  <th class="no-export">Delete</th>
                </tr>
              </thead>
              <tbody id="itemsTableBody"></tbody>
            </table>
            <button id="addItemBtn" class="no-export">‚ûï Add Item</button>
          </div>
 <div class="section details-section">
            
            <div class="summary">
              <h3 style="font-size:14px;">Summary</h3>
              <table>
                <tbody><tr><td>Subtotal</td><td id="subtotal">AED 0</td></tr>
                
                </tbody>
                
                <tbody><tr><td>VAT (5%)</td><td id="tax">AED 0</td></tr>
                </tbody><tbody id="extraFields"></tbody>
                <tbody><tr class="tablec"><td> <input style="font-weight: bold; background:transparent; text-align: center; color:#fff; border-color:transparent;" value="TOTAL"></td><td id="amountDueToday">AED 0</td></tr>
              </tbody></table>
            </div>
          </div>
 <table class="MsoTableGrid" border="1" cellspacing="0" cellpadding="0" width="752" style="width:563.65pt;margin-left:5px; margin-top:15px; border-collapse:collapse;border:
 none;mso-border-alt:solid windowtext .5pt;mso-yfti-tbllook:1184;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt">
 <tbody><tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes;height:13.9pt">
  <td width="42" valign="top" style="width:31.5pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;background:#D9D9D9;mso-background-themecolor:
  background1;mso-background-themeshade:217;padding:0cm 5.4pt 0cm 5.4pt;
  height:13.9pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;color:black;mso-color-alt:windowtext;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB">#</span></span><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB"><o:p></o:p></span></span></p>
  </td>
  
  <td width="402" valign="top" style="width:301.5pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#D9D9D9;mso-background-themecolor:background1;
  mso-background-themeshade:217;padding:0cm 5.4pt 0cm 5.4pt;height:13.9pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;color:black;mso-color-alt:windowtext;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB">Item</span></span><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB"><o:p></o:p></span></span></p>
  </td>
  
  <td width="102" valign="top" style="width:76.5pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#D9D9D9;mso-background-themecolor:background1;
  mso-background-themeshade:217;padding:0cm 5.4pt 0cm 5.4pt;height:13.9pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;color:black;mso-color-alt:windowtext;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB">Provided by</span></span><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB"><o:p></o:p></span></span></p>
  </td>
  
  <td width="206" valign="top" style="width:154.15pt;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#D9D9D9;mso-background-themecolor:background1;
  mso-background-themeshade:217;padding:0cm 5.4pt 0cm 5.4pt;height:13.9pt">
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;color:black;mso-color-alt:windowtext;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB">Notes</span></span><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB"><o:p></o:p></span></span></p>
  </td>
  
 </tr>
 <tr style="mso-yfti-irow:1;mso-yfti-lastrow:yes">
  <td width="42" valign="top" style="width:31.5pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt"><span style="mso-bookmark:_Hlk166673842"></span>
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"><o:p>&nbsp;</o:p></span></span></p>
  </td>
  
  <td width="402" valign="top" style="width:301.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt">
  <p class="MsoListParagraph" style="margin:0cm;mso-add-space:auto;text-align:
  left;line-height:normal;tab-stops:12.15pt;direction:ltr;unicode-bidi:embed"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB">No specific condition <o:p></o:p></span></span></p>
  </td>
  
  <td width="102" valign="top" style="width:76.5pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt"><span style="mso-bookmark:_Hlk166673842"></span>
  <p class="MsoNormal" align="center" style="margin-bottom:0cm;text-align:center;
  line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:
  minor-bidi;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-theme-font:
  minor-bidi;mso-bidi-theme-font:minor-bidi;mso-ansi-language:EN-GB;mso-fareast-language:
  EN-GB"><o:p>&nbsp;</o:p></span></span></p>
  </td>
  
  <td width="206" valign="top" style="width:154.15pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt"><span style="mso-bookmark:_Hlk166673842"></span>
  <p class="MsoNormal" style="margin-bottom:0cm;line-height:normal"><span style="mso-bookmark:_Hlk166673842"><span lang="EN-GB" style="font-size:10.0pt;
  font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;mso-fareast-font-family:
  &quot;Times New Roman&quot;;mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;
  mso-ansi-language:EN-GB;mso-fareast-language:EN-GB"><o:p>&nbsp;</o:p></span></span></p>
  </td>
  
 </tr>
</tbody></table>
          
          <div class="section details-section">
           <div style="margin-left:45px; padding-right: 60px;"><tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes ">
  <td width="456" valign="top" style="width:342.0pt;padding:0cm 5.4pt 0cm 5.4pt">
  <p class="MsoNormal" style="margin-bottom:0cm;line-height:normal;mso-element:
  frame;mso-element-frame-hspace:9.0pt;mso-element-wrap:around;mso-element-anchor-vertical:
  paragraph;mso-element-anchor-horizontal:margin;mso-element-top:44.05pt;
  mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><b><span lang="EN-GB" style="font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;
  mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;mso-ansi-language:
  EN-GB;mso-fareast-language:EN-GB"><span style="mso-spacerun:yes">&nbsp;&nbsp;&nbsp; </span>Submitted
  by: <o:p></o:p></span></b></span></p>
  <p class="MsoNormal" style="margin-bottom:0cm;line-height:normal;mso-element:
  frame;mso-element-frame-hspace:9.0pt;mso-element-wrap:around;mso-element-anchor-vertical:
  paragraph;mso-element-anchor-horizontal:margin;mso-element-top:44.05pt;
  mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><b><span lang="EN-GB" style="font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;
  mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;mso-ansi-language:
  EN-GB;mso-fareast-language:EN-GB"><input style="width:400px; margin-left:-18px; font-weight: bold; font-size: 18px; background:transparent; text-align: left; color:#000; border-color:transparent;" value="Engr. Mohamed Adel"><span style="mso-spacerun:yes">&nbsp; </span><br>
  <input style="width:400px; margin-left:-18px; font-weight: bold; font-size: 18px; background:transparent; text-align: left; color:#000; border-color:transparent;" value="Technical Office Engineer"><o:p></o:p></span></b></span></p>
             </td></tr>
  </div>
    <div>
  <tr style="mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes">
    <td width="233" valign="top" style="width:175.0pt;padding:0cm 5.4pt 0cm 5.4pt">
  <p class="MsoNormal" style="margin-bottom:0cm;line-height:115%;mso-element:
  frame;mso-element-frame-hspace:9.0pt;mso-element-wrap:around;mso-element-anchor-vertical:
  paragraph;mso-element-anchor-horizontal:margin;mso-element-top:44.05pt;
  mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><b><span lang="EN-GB" style="font-family:&quot;Arial&quot;,sans-serif;mso-ascii-theme-font:minor-bidi;
  mso-hansi-theme-font:minor-bidi;mso-bidi-theme-font:minor-bidi;mso-ansi-language:
  EN-GB;mso-fareast-language:EN-GB"><span style="mso-spacerun:yes">&nbsp;&nbsp; </span>Approved
  BY: <o:p></o:p></span></b></span></p>
  <p class="MsoNormal" style="margin-bottom:0cm;line-height:normal;mso-element:
  frame;mso-element-frame-hspace:9.0pt;mso-element-wrap:around;mso-element-anchor-vertical:
  paragraph;mso-element-anchor-horizontal:margin;mso-element-top:44.05pt;
  mso-height-rule:exactly"><span style="mso-bookmark:_Hlk166673842"><b><span>
 <input style="width:400px; margin-left:-18px; font-weight: bold; font-size: 18px; background:transparent; text-align: left; color:#000; border-color:transparent;" value="Engr. Mohamed Ali">  <br>
  <input style="width:400px; margin-left:-18px; font-weight: bold; font-size: 18px; background:transparent; text-align: left; color:#000; border-color:transparent;" value="Project Manager"> 
  <!--[if !supportLineBreakNewLine]--><br style="mso-special-character:line-break">
  <!--[endif]--><o:p></o:p></span></b></span></p>
  </td>
  
 </tr>
          </div></div>

          <div class="action-buttons no-export">
            <button class="lpo-btn" id="saveBtn">üíæ Save LPO</button>
            <button class="lpo-btn" id="exportBtn">üìÑ Export PDF</button>
            <button class="lpo-btn" id="printBtn">üñ®Ô∏è Print</button>
            <button class="delete-btn" id="clearBtn">üßπ Clear Form</button>
          </div>
        </div>
        <div class="footer"></div>
      </div>
    </div>
  </div>

  <div class="saved-lpos-panel no-export">
    <h3>Saved LPOs</h3>
    <ul id="lpoList"></ul>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// Initialize jsPDF
const { jsPDF } = window.jspdf;

// Helper functions
function formatNumberWithCommas(val) {
  if (val === "" || val === null || isNaN(val)) return "";
  const valStr = String(val);
  if (valStr.includes(".")) {
    let [intPart, decPart] = valStr.split(".");
    intPart = Number(intPart).toLocaleString();
    decPart = decPart ? decPart.substring(0, 2) : "";
    return decPart.length > 0 ? `${intPart}.${decPart}` : intPart;
  }
  return Number(val).toLocaleString();
}

function parseAndFormatInput(e) {
  let val = e.target.value.replace(/,/g, "");
  if (val === "") {
    e.target.value = "";
    return;
  }
  if (val.includes(".")) {
    let [intPart, decPart] = val.split(".");
    intPart = intPart === "" ? "0" : intPart;
    let formatted = Number(intPart).toLocaleString();
    if (typeof decPart !== "undefined") {
      decPart = decPart.substring(0, 2);
      e.target.value = decPart.length > 0 ? `${formatted}.${decPart}` : formatted;
    } else {
      e.target.value = formatted;
    }
  } else {
    let num = parseFloat(val);
    if (!isNaN(num)) {
      e.target.value = formatNumberWithCommas(num);
    }
  }
}

let itemsBody = document.getElementById("itemsTableBody");
let subtotalEl = document.getElementById("subtotal");
let taxEl = document.getElementById("tax");
let amountDueTodayEl = document.getElementById("amountDueToday");
let saveBtn = document.getElementById("saveBtn");
let exportBtn = document.getElementById("exportBtn");
let printBtn = document.getElementById("printBtn");
let clearBtn = document.getElementById("clearBtn");

function createItemRow(description = "", unit = "", quantity = 1, price = 0, total = 0) {
  const row = document.createElement("tr");
  row.classList.add("lpo-item");
  row.innerHTML = `
    <td><textarea class="desc" style="font-size: 14px;width: 100%; background:transparent; border-color:transparent; resize: both;">${description}</textarea></td>
    <td><input style="text-align: center;" value="${unit}" class="unit"></td>
    <td><input style="text-align: center; width: 30px;" type="text" value="${formatNumberWithCommas(quantity)}" class="qty"></td>
    <td><input style="text-align: center;" type="text" value="${formatNumberWithCommas(price)}" class="price"></td>
    <td class="total">${formatNumberWithCommas(total)}</td>
    <td class="no-export"><button class="delete-btn">‚ùå</button></td>
  `;

  row.querySelector(".delete-btn").addEventListener("click", () => {
    row.remove();
    calculateTotals();
  });

  [".qty", ".price"].forEach(cls => {
    let input = row.querySelector(cls);
    input.addEventListener("input", (e) => {
      parseAndFormatInput(e);
      calculateTotals();
    });
  });

  row.querySelector(".desc").addEventListener("input", calculateTotals);
  row.querySelector(".unit").addEventListener("input", calculateTotals);

  itemsBody.appendChild(row);
  calculateTotals();
}

function calculateTotals() {
  let subtotal = 0;
  itemsBody.querySelectorAll("tr").forEach(row => {
    const qty = parseFloat(row.querySelector(".qty").value.replace(/,/g, "")) || 0;
    const price = parseFloat(row.querySelector(".price").value.replace(/,/g, "")) || 0;
    subtotal += qty * price;
  });

  let vat = subtotal * 0.05;
  let amountDueToday = subtotal + vat;

  subtotalEl.textContent = `AED ${formatNumberWithCommas(subtotal)}`;
  taxEl.textContent = `AED ${formatNumberWithCommas(vat)}`;
  amountDueTodayEl.textContent = `AED ${formatNumberWithCommas(amountDueToday)}`;
}

function getlpoData() {
  return {
    date: document.getElementById('lpoDate').value,
    reference: document.getElementById('reference').value,
    clientName: document.getElementById('clientName').value,
    clientName1: document.getElementById('clientName1').value,
    attEmail: document.getElementById('attEmail').value,
    attEmail1: document.getElementById('attEmail1').value,
    attEmail2: document.getElementById('attEmail2').value,
    attEmail3: document.getElementById('attEmail3').value,
    lpoNumber: document.getElementById('lpoNumber').value,
    projectName: document.getElementById('projectName').value,
    projectName1: document.getElementById('projectName1').value,
    projectName2: document.getElementById('projectName2').value,
    location: document.getElementById('location').value,
    location1: document.getElementById('location1').value,
    items: Array.from(document.querySelectorAll("#itemsTableBody tr")).map(row => ({
      description: row.querySelector(".desc").value,
      unit: row.querySelector(".unit").value,
      quantity: parseFloat(row.querySelector(".qty").value.replace(/,/g, "")) || 0,
      price: parseFloat(row.querySelector(".price").value.replace(/,/g, "")) || 0,
    }))
  };
}

function clearlpo() {
  document.getElementById('lpoDate').value = '';
  document.getElementById('reference').value = '';
  document.getElementById('clientName').value = '';
  document.getElementById('clientName1').value = '';
  document.getElementById('attEmail').value = '';
  document.getElementById('attEmail1').value = '';
  document.getElementById('attEmail2').value = '';
  document.getElementById('attEmail3').value = '';
  document.getElementById('lpoNumber').value = '';
  document.getElementById('projectName').value = '';
  document.getElementById('projectName1').value = '';
  document.getElementById('projectName2').value = '';
  document.getElementById('location').value = '';
  document.getElementById('location1').value = '';
  itemsBody.innerHTML = '';
  createItemRow();
  calculateTotals();
}

document.getElementById("addItemBtn").addEventListener("click", () => createItemRow());
saveBtn.addEventListener("click", () => alert("Save functionality works!")); // Placeholder
printBtn.addEventListener("click", () => window.print());
clearBtn.addEventListener("click", clearlpo);

exportBtn.addEventListener("click", async () => {
  document.body.classList.add("export-pdf");

  const lpo = document.querySelector('.lpo');
  const clone = lpo.cloneNode(true);
  clone.querySelectorAll('textarea').forEach(textarea => {
    const div = document.createElement('div');
    div.style.whiteSpace = 'pre-line';
    div.style.fontSize = textarea.style.fontSize || '14px';
    div.textContent = textarea.value;
    textarea.parentNode.replaceChild(div, textarea);
  });

  const tempContainer = document.createElement('div');
  tempContainer.style.position = 'absolute';
  tempContainer.style.left = '-9999px';
  tempContainer.appendChild(clone);
  document.body.appendChild(tempContainer);

  try {
    const canvas = await html2canvas(clone, {
      scale: 2,
      logging: false,
      useCORS: true,
      allowTaint: true,
      scrollX: 0,
      scrollY: 0
    });

    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgData = canvas.toDataURL('image/png');
    const imgWidth = 210;
    const pageHeight = 295;
    const imgHeight = canvas.height * imgWidth / canvas.width;

    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
    const lpoNumber = document.getElementById('reference').value || 'lpo';
    pdf.save(`${lpoNumber}.pdf`);
  } catch (error) {
    console.error('PDF Export Error:', error);
    alert('PDF export failed.');
  } finally {
    document.body.removeChild(tempContainer);
    document.body.classList.remove("export-pdf");
  }
});

window.onload = () => {
  createItemRow();
};
</script>

</body>
</html>
